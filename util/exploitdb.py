#!/usr/bin/env python2
#jesus.olmos@blueliv.com

import sys
from mechanize import Browser
import re

class ExploitDB:
	def __init__(self):
		self.ua = 'Mozilla/5.0 (X11; Linux x86_64; rv:7.0.1) Gecko/20100101 Firefox/7.0.1'
		self.url_base = 'http://www.exploit-db.com/search/'

		self.b = Browser()
		self.b.addheaders = [('User-agent', self.ua)]
		self.b.set_handle_robots(False)

	def searchDescription(self,txt):
		self.__submit('filter_description',txt)
	def searchCode(self,txt):
		self.__submit('filter_exploit_text',txt)
	def searchAuthor(self,txt):
		self.__submit('filter_author',txt)

	def __submit(self,param,value):
		self.b.open(self.url_base)
		self.b.select_form(nr=0)
		self.b[param] = value
		self.b.submit()
		self.__parseLinks()

	def __parseLinks(self):
		next_page = False
		for l in self.b.links():
			if l.url.find('/exploits/')>-1:
				#id = re.sub('.*/exploits/','',l.url)
				print l.text+"\t\t\t"+l.url

			elif l.text == "next":
				if next_page:
					l.url = l.url.replace('%09','')
					self.b.open(l.url)
					#self.b.follow_link(l)
					self.__parseLinks()
					return
				else:
					next_page = True



if __name__ == "__main__":
	db = ExploitDB()
	db.searchDescription(sys.argv[1]);


